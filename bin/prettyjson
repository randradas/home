#!/bin/bash
function usage {
  echo 'e.g: prettyjson ./myfile.json [-s]'
  echo ''
  echo '  -s        substitute json file by the one generated by prettyjson'
  echo ''
  exit 1
}


if [ $# -gt 0 ]
then
  if [ $# -eq 1 ]
  then
    JSONFILE=$1
  elif [ $# -eq 2 ]
  then
    JSONFILE=$1
    case $2 in
      -s| --substitute)
        SUBSTITUTE=true
        ;;
      -h| --help)
        usage
        exit 0
        ;;
      *)
        usage
        exit 1
        ;;
    esac
  else
    usage
    exit 1
  fi
else
  usage
  exit 1
fi


RANDOMFILE="/tmp/$(basename $0)-$RANDOM-$(date +%s)"

if [ -z "$SUBSTITUTE" ]
then
  cat $JSONFILE | jq ''
else
  cat $JSONFILE | jq '' > $RANDOMFILE
  [ $? -eq 0 ] && mv $RANDOMFILE $JSONFILE
fi

exit 0
